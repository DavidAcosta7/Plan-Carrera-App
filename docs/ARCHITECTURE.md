# ğŸ—ï¸ ARQUITECTURA - Plan Carrera + Claude AI

## Diagrama General

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     USUARIO                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   index.html    â”‚
                    â”‚   (SPA Entry)   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                    â”‚                    â”‚
   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
   â”‚  Landing  â”‚      â”‚   Register  â”‚     â”‚   Login     â”‚
   â”‚  (/)      â”‚      â”‚  (/register)â”‚     â”‚ (/login)    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                             â”‚                    â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    Primer Login?           â”‚
                    â”‚   (checkIsFirstTime)       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚          â”‚
                        SÃ­ â”‚          â”‚ No
                           â”‚          â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”         â”‚
        â”‚   ONBOARDING      â”‚         â”‚
        â”‚   (/onboarding)   â”‚         â”‚
        â”‚                   â”‚         â”‚
        â”‚  5 Preguntas:     â”‚         â”‚
        â”‚  1. Level         â”‚         â”‚
        â”‚  2. Interests     â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  3. TimePerDay    â”‚         â”‚  â”‚  DASHBOARD       â”‚
        â”‚  4. Goal          â”‚         â”‚  â”‚  (/dashboard)    â”‚
        â”‚  5. Deadline      â”‚         â”‚  â”‚                  â”‚
        â”‚                   â”‚         â”‚  â”‚ - Lista de plans â”‚
        â”‚  [Generar]        â”‚         â”‚  â”‚ - Nuevo plan btn â”‚
        â”‚      â”‚            â”‚         â”‚  â”‚ - Editar/Borrar  â”‚
        â”‚      â–¼            â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚  AIService        â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
        â”‚  .generatePlan()  â”‚                    â”‚â”‚
        â”‚      â”‚            â”‚                    â”‚â”‚
        â”‚      â””â”€â”          â”‚                    â”‚â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚â”‚
                 â”‚                               â”‚â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚
    â”‚                                           â”‚â”‚â”‚
    â”‚     CLAUDE API (Anthropic)                â”‚â”‚
    â”‚                                           â”‚â”‚
    â”‚  POST /v1/messages                        â”‚â”‚
    â”‚  {                                        â”‚â”‚
    â”‚    prompt: userAnswers                    â”‚â”‚
    â”‚  }                                        â”‚â”‚
    â”‚        â†“                                  â”‚â”‚
    â”‚  Response: JSON                           â”‚â”‚
    â”‚  {                                        â”‚â”‚
    â”‚    title, description,                    â”‚â”‚
    â”‚    phases: [...]                          â”‚â”‚
    â”‚  }                                        â”‚â”‚
    â”‚                                           â”‚â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚
                    â”‚                           â”‚â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚â”‚
          â”‚  Parse & Validate  â”‚                â”‚â”‚
          â”‚  PlanService       â”‚                â”‚â”‚
          â”‚  .savePlan()       â”‚                â”‚â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚â”‚
                    â”‚                           â”‚â”‚
                    â–¼                           â”‚â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚
    â”‚  SUPABASE / PostgreSQL                 â”‚ â”‚â”‚
    â”‚                                        â”‚ â”‚â”‚
    â”‚  career_plans                          â”‚ â”‚â”‚
    â”‚  â”œâ”€ id (UUID)                         â”‚ â”‚â”‚
    â”‚  â”œâ”€ user_id (FK)                      â”‚ â”‚â”‚
    â”‚  â”œâ”€ title, description                â”‚ â”‚â”‚
    â”‚  â”œâ”€ plan_content (JSON)               â”‚ â”‚â”‚
    â”‚  â”œâ”€ user_answers (JSON)               â”‚ â”‚â”‚
    â”‚  â”œâ”€ is_primary (BOOLEAN)              â”‚ â”‚â”‚
    â”‚  â””â”€ created_at, updated_at            â”‚ â”‚â”‚
    â”‚                                        â”‚ â”‚â”‚
    â”‚  plan_progress                         â”‚ â”‚â”‚
    â”‚  â”œâ”€ completed_phases                  â”‚ â”‚â”‚
    â”‚  â”œâ”€ completed_projects                â”‚ â”‚â”‚
    â”‚  â””â”€ expanded_phases                   â”‚ â”‚â”‚
    â”‚                                        â”‚ â”‚â”‚
    â”‚  plan_generation_log (auditorÃ­a)      â”‚ â”‚â”‚
    â”‚  onboarding_responses (anÃ¡lisis)      â”‚ â”‚â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚
                     â”‚                         â”‚â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
                                      â”‚         â”‚
                                      â–¼         â”‚
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                              â”‚  Dashboard   â”‚ â”‚
                              â”‚  (Cargado)   â”‚â—„â”˜
                              â”‚              â”‚
                              â”‚ - Plan 1     â”‚
                              â”‚ - Plan 2     â”‚
                              â”‚ - New btn    â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Flujo de GeneraciÃ³n de Plan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. USUARIO RESPONDE PREGUNTAS                               â”‚
â”‚                                                             â”‚
â”‚  Level: "beginner"                                         â”‚
â”‚  Interests: ["Python", "SQL"]                              â”‚
â”‚  TimePerDay: "2"                                           â”‚
â”‚  Goal: "job"                                               â”‚
â”‚  Deadline: "6"                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. AISERVICE CONSTRUYE PROMPT                               â”‚
â”‚                                                             â”‚
â”‚  "Como experto en desarrollo de software..."               â”‚
â”‚  "Nivel actual: beginner"                                  â”‚
â”‚  "Intereses: Python, SQL"                                  â”‚
â”‚  "..."                                                     â”‚
â”‚  "Responde en formato JSON..."                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. LLAMADA A CLAUDE API                                     â”‚
â”‚                                                             â”‚
â”‚  POST https://api.anthropic.com/v1/messages                â”‚
â”‚  {                                                         â”‚
â”‚    "model": "claude-3-5-sonnet-20241022",                 â”‚
â”‚    "max_tokens": 2048,                                     â”‚
â”‚    "messages": [{                                          â”‚
â”‚      "role": "user",                                       â”‚
â”‚      "content": "..."                                      â”‚
â”‚    }]                                                      â”‚
â”‚  }                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. CLAUDE GENERA PLAN ÃšNICO                                 â”‚
â”‚                                                             â”‚
â”‚  {                                                         â”‚
â”‚    "title": "Plan Python + SQL (6 meses)",                â”‚
â”‚    "description": "Plan personalizado para...",            â”‚
â”‚    "totalPhases": 4,                                       â”‚
â”‚    "phases": [                                             â”‚
â”‚      {                                                     â”‚
â”‚        "id": 1,                                            â”‚
â”‚        "title": "Fundamentos de Python",                   â”‚
â”‚        "duration": "4-6 semanas",                          â”‚
â”‚        "topics": ["variables", "funciones"],              â”‚
â”‚        "projects": [                                       â”‚
â”‚          {                                                 â”‚
â”‚            "title": "ğŸ“Š Analizador de Datos",             â”‚
â”‚            "difficulty": "easy",                          â”‚
â”‚            "requirements": [...]                          â”‚
â”‚          }                                                 â”‚
â”‚        ]                                                   â”‚
â”‚      }                                                     â”‚
â”‚    ]                                                       â”‚
â”‚  }                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. PARSE Y VALIDACIÃ“N                                       â”‚
â”‚                                                             â”‚
â”‚  âœ“ JSON vÃ¡lido                                             â”‚
â”‚  âœ“ Estructura completa                                     â”‚
â”‚  âœ“ Todas las fases con proyectos                           â”‚
â”‚  âœ“ Campos requeridos presentes                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. GUARDAR EN SUPABASE                                      â”‚
â”‚                                                             â”‚
â”‚  INSERT INTO career_plans (                                â”‚
â”‚    user_id,                                                â”‚
â”‚    title,                                                  â”‚
â”‚    plan_content,      â† JSON completo de Claude            â”‚
â”‚    user_answers,      â† Respuestas del usuario             â”‚
â”‚    is_primary                                              â”‚
â”‚  )                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. USUARIO VE PLAN EN DASHBOARD                             â”‚
â”‚                                                             â”‚
â”‚  Dashboard carga:                                          â”‚
â”‚  âœ“ Plan 1: "Plan Python + SQL (6 meses)"                  â”‚
â”‚  âœ“ BotÃ³n "Nuevo Plan de Carrera"                          â”‚
â”‚  âœ“ Puede crear segundo plan diferente                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Capas de Arquitectura

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  PRESENTATION LAYER                         â”‚
â”‚                   (HTML + CSS + JS)                         â”‚
â”‚                                                             â”‚
â”‚  - index.html (SPA entry point)                            â”‚
â”‚  - pages/onboarding.html                                   â”‚
â”‚  - pages/dashboard.html                                    â”‚
â”‚  - styles.css                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               LOGIC LAYER (Frontend)                         â”‚
â”‚                 (Vanilla JavaScript)                        â”‚
â”‚                                                             â”‚
â”‚  - utils/router.js (SPA routing)                           â”‚
â”‚  - pages/onboarding.html (5 questions logic)               â”‚
â”‚  - pages/dashboard.html (plans management)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            SERVICE LAYER (Business Logic)                    â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  AIService         â”‚  â”‚ PlanService  â”‚  â”‚ AuthServiceâ”‚ â”‚
â”‚  â”‚                    â”‚  â”‚              â”‚  â”‚            â”‚ â”‚
â”‚  â”‚ - generatePlan()   â”‚  â”‚ - savePlan() â”‚  â”‚ - checkIsF.â”‚ â”‚
â”‚  â”‚ - callClaude()     â”‚  â”‚ - getPlan()  â”‚  â”‚ - markDone â”‚
â”‚  â”‚ - parseResponse()  â”‚  â”‚ - getProgressâ”‚  â”‚ - getUser()â”‚
â”‚  â”‚ - validatePlan()   â”‚  â”‚ - saveProgress            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           INTEGRATION LAYER (External APIs)                  â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Claude API          â”‚    â”‚  Supabase Client         â”‚  â”‚
â”‚  â”‚  (Anthropic)         â”‚    â”‚  (Database + Auth)       â”‚  â”‚
â”‚  â”‚                      â”‚    â”‚                          â”‚  â”‚
â”‚  â”‚ POST /v1/messages    â”‚    â”‚ - supabase.from()        â”‚  â”‚
â”‚  â”‚ - Prompt: user data  â”‚    â”‚ - supabase.auth          â”‚  â”‚
â”‚  â”‚ - Response: JSON     â”‚    â”‚ - RLS enforced           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            DATA LAYER (PostgreSQL/Supabase)                  â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚  career_plans    â”‚  â”‚ plan_progress    â”‚                â”‚
â”‚  â”‚  (Persistent)    â”‚  â”‚ (Progress Track) â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚  plan_gen_log    â”‚  â”‚ onboarding_resp  â”‚                â”‚
â”‚  â”‚  (Audit Trail)   â”‚  â”‚ (Analytics)      â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Entidades de Base de Datos

```
USUARIO (auth.users - Supabase Auth)
  â”œâ”€ id (UUID)
  â”œâ”€ email
  â”œâ”€ created_at
  â””â”€ user_metadata

  â†“ 1:N

PLANS (career_plans)
  â”œâ”€ id (UUID)
  â”œâ”€ user_id (FK)
  â”œâ”€ title
  â”œâ”€ description
  â”œâ”€ plan_content (JSON generado por Claude)
  â”œâ”€ user_answers (JSON)
  â”œâ”€ is_primary (BOOLEAN - un activo por usuario)
  â”œâ”€ status ('active' | 'deleted')
  â”œâ”€ created_at
  â””â”€ updated_at

  â”œâ”€ 1:1 â†’ PRIMARY PLAN (is_primary = true)
  â”‚
  â””â”€ 1:N â†’ PROGRESS (plan_progress)
           â”œâ”€ completed_phases (JSONB)
           â”œâ”€ completed_projects (JSONB)
           â””â”€ expanded_phases (JSONB)

  â””â”€ 1:N â†’ GENERATION LOG (plan_generation_log)
           â”œâ”€ prompt_used
           â”œâ”€ generation_time_ms
           â”œâ”€ success (BOOLEAN)
           â””â”€ error_message
```

---

## Flujo de Seguridad (RLS)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Usuario 1 intenta acceso   â”‚
â”‚  SELECT * FROM career_plans â”‚
â”‚  WHERE user_id = 'usr-1'    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RLS Policy: career_plans_policy    â”‚
â”‚                                     â”‚
â”‚  IF auth.uid() = user_id THEN       â”‚
â”‚    âœ“ Acceso permitido               â”‚
â”‚  ELSE                               â”‚
â”‚    âœ— Acceso denegado                â”‚
â”‚  END IF                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Usuario solo ve sus planes â”‚
â”‚  - Plan 1 (generado por IA) â”‚
â”‚  - Plan 2 (generado por IA) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Usuario 2 intenta acceso   â”‚
â”‚  a planes de Usuario 1      â”‚
â”‚  WHERE user_id = 'usr-1'    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RLS Policy: career_plans_policy    â”‚
â”‚                                     â”‚
â”‚  IF auth.uid() = 'usr-1' THEN       â”‚
â”‚    âœ— auth.uid() = 'usr-2'           â”‚
â”‚    âœ— Acceso denegado                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Error 401 - No autorizado   â”‚
â”‚  Usuario 2 no ve nada        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Variables de Entorno

```
.env.local (Desarrollo)
â”œâ”€ VITE_ANTHROPIC_API_KEY
â”‚  â””â”€ sk-ant-xxxxxxxxxxxxx (Claude API)
â”‚
â”œâ”€ VITE_SUPABASE_URL
â”‚  â””â”€ https://xxxxx.supabase.co (BD)
â”‚
â””â”€ VITE_SUPABASE_ANON_KEY
   â””â”€ sb_publishable_xxxxx (Auth pÃºblica)

Vercel (ProducciÃ³n)
â”œâ”€ Mismas variables
â””â”€ Configuradas en Settings â†’ Environment Variables
```

---

## Ciclo de Vida de un Plan

```
CREATION (Primera vez usuario)
  â†“
1. Usuario responde 5 preguntas
   â””â”€ level, interests, timePerDay, goal, deadline
  â†“
2. AIService.generateCareerPlan()
   â””â”€ EnvÃ­a a Claude API
  â†“
3. Claude retorna JSON
   â”œâ”€ title, description
   â”œâ”€ phases (4-6)
   â”‚  â”œâ”€ topics (temas)
   â”‚  â”œâ”€ projects (2-3 por fase)
   â”‚  â””â”€ resources (cursos)
   â””â”€ recommendations
  â†“
4. PlanService.savePlan()
   â””â”€ INSERT en career_plans
      â”œâ”€ plan_content (JSON de Claude)
      â”œâ”€ user_answers (respuestas usuario)
      â””â”€ is_primary = true (primer plan)
  â†“
5. Dashboard carga plan
   â””â”€ Muestra en grid de planes
  â†“

USAGE (Usuario aprende)
  â†“
6. Usuario marca fases completadas
   â””â”€ UPDATE plan_progress
  â†“
7. Usuario marca proyectos completados
   â””â”€ UPDATE plan_progress
  â†“

CREATION 2 (Nuevo plan)
  â†“
8. Usuario click "Nuevo Plan"
   â””â”€ is_primary del plan anterior = false
  â†“
9. Repite pasos 1-5
   â””â”€ Nuevo plan con is_primary = true
  â†“
10. Dashboard muestra ambos planes
    â”œâ”€ Plan 1 (archivado)
    â””â”€ Plan 2 (activo)
  â†“

DELETION (Usuario elimina plan)
  â†“
11. Usuario click "Borrar"
    â””â”€ UPDATE status = 'deleted'
       (NO se borra definitivamente)
  â†“
12. Plan no aparece en dashboard
    â””â”€ RLS filtra WHERE status = 'active'
  â†“
```

---

## Flujo de Datos Entre Capas

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User Input  â”‚ (5 preguntas respondidas)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ HTML Form Data
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  onboarding.html                     â”‚
â”‚  - Validar respuestas               â”‚
â”‚  - Mostrar Loading state            â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ userAnswers object
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  aiService.generateCareerPlan()      â”‚
â”‚  - Construir prompt                 â”‚
â”‚  - Llamar a Claude                  â”‚
â”‚  - Parsear JSON                     â”‚
â”‚  - Validar estructura               â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ plan object (JSON)
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  planService.savePlan()              â”‚
â”‚  - Formatear para BD                â”‚
â”‚  - Insertar en career_plans         â”‚
â”‚  - Retornar plan con ID             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ planId
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Supabase / PostgreSQL               â”‚
â”‚  - INSERT career_plans               â”‚
â”‚  - INSERT onboarding_responses       â”‚
â”‚  - INSERT plan_generation_log        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ success response
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Redirect to Dashboard               â”‚
â”‚  dashboard.html                      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Show Plans
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Load user plans                     â”‚
â”‚  planService.getUserPlans(userId)    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ plans[] array
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Render Dashboard                    â”‚
â”‚  - Mostrar grid de planes           â”‚
â”‚  - BotÃ³n "Nuevo Plan"               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ConclusiÃ³n

Esta arquitectura asegura:

âœ… **SeparaciÃ³n de Responsabilidades**
- Frontend (HTML/CSS/JS)
- Services (LÃ³gica de negocio)
- Database (Persistencia)
- External APIs (Claude, Supabase)

âœ… **Escalabilidad**
- Multi-usuario
- MÃºltiples planes
- AuditorÃ­a completa

âœ… **Seguridad**
- RLS en todas las tablas
- API Keys en entorno
- ValidaciÃ³n en capas

âœ… **Mantenibilidad**
- CÃ³digo modular
- Servicios reutilizables
- DocumentaciÃ³n completa

---

**VersiÃ³n**: 1.0.0
**ActualizaciÃ³n**: 29 de enero de 2026
